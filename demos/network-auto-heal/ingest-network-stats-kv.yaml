metadata:
  labels:
    nuclio.io/project-name: 2328ee8b-2dfa-44d7-802f-71d473518154
  name: ingeststats
spec:
  env:
    - type: value
      name: IGZ_USER
      value: iguazio
    - type: value
      name: IGZ_PASS
      value: datal@ke!
    - type: value
      name: SCORE_KV
      value: network_monitor_score
    - type: value
      name: RAW_KV
      value: network_monitor_historical
    - type: value
      name: NGINX_HOST
      value: webapi.default-tenant.app.poc605.staging.iguazio.com
    - type: value
      name: NGINX_PORT
      value: "8081"
    - type: value
      name: CONTAINER_NAME
      value: bigdata
    - type: value
      name: BATCH_SIZE
      value: "20"
    - type: value
      name: LINK_UP_WAIT_INTERVAL
      value: "10"
    - type: value
      name: LATENCY_UP_WAIT_INTERVAL
      value: "10"
    - type: value
      name: LATENCY_DOWN_WAIT_INTERVAL
      value: "10"
    - type: value
      name: PACKET_RATE_DOWN_WAIT_INTERVAL
      value: "3"
    - type: value
      name: PACKET_RATE_UP_WAIT_INTERVAL
      value: "10"
    - type: value
      name: UTILIZATION_50_80_WAIT_INTERVAL
      value: "3"
    - type: value
      name: UTILIZATION_80_100_WAIT_INTERVAL
      value: "3"
    - type: value
      name: UTILIZATION_DOWN_WAIT_INTERVAL
      value: "10"
  httpPort: 0
  imageHash: "1560218937845662793"
  description: "Showcases unstructured logging and a structured response."
  targetCpu: 0
  replicas: 0
  publish: false
  loggerSinks:
    - level: debug
  timeoutSeconds: 0
  disable: false
  alias: latest
  handler: "main:handler"
  maxReplicas: 1
  platform: {}
  version: -1
  readinessTimeoutSeconds: 0
  runtime: "python:3.6"
  minReplicas: 1
  resources: {}
  build:
    commands:
      - 'pip install requests'
    functionSourceCode: IyEvdXNyL2Jpbi9weXRob24KaW1wb3J0IGNvbGxlY3Rpb25zCmltcG9ydCBkYXRldGltZQppbXBvcnQganNvbgppbXBvcnQgbWF0aAppbXBvcnQgbnVtYmVycwppbXBvcnQgb3MucGF0aAoKaW1wb3J0IHJlcXVlc3RzCgojIElndWF6aW8gcGxhdGZvcm0gdmFyaWFibGVzCk5HSU5YX0hPU1QgPSBvcy5nZXRlbnYoJ05HSU5YX0hPU1QnKQpOR0lOWF9QT1JUID0gb3MuZ2V0ZW52KCdOR0lOWF9QT1JUJykKQ09OVEFJTkVSX05BTUUgPSBvcy5nZXRlbnYoJ0NPTlRBSU5FUl9OQU1FJykKSUdaX1VTRVIgPSBvcy5nZXRlbnYoJ0lHWl9VU0VSJykKSUdaX1BBU1MgPSBvcy5nZXRlbnYoJ0lHWl9QQVNTJykKCiMgQXBwbGljYXRpb24gdmFyaWFibGVzClNDT1JFX0tWID0gb3MuZ2V0ZW52KCdTQ09SRV9LVicpClJBV19LViA9IG9zLmdldGVudignUkFXX0tWJykKQkFUQ0hfU0laRSA9IG9zLmdldGVudignQkFUQ0hfU0laRScpCkxJTktfVVBfV0FJVF9JTlRFUlZBTCA9IG9zLmdldGVudignTElOS19VUF9XQUlUX0lOVEVSVkFMJykKTEFURU5DWV9VUF9XQUlUX0lOVEVSVkFMID0gb3MuZ2V0ZW52KCdMQVRFTkNZX1VQX1dBSVRfSU5URVJWQUwnKQpMQVRFTkNZX0RPV05fV0FJVF9JTlRFUlZBTCA9IG9zLmdldGVudignTEFURU5DWV9ET1dOX1dBSVRfSU5URVJWQUwnKQpQQUNLRVRfUkFURV9ET1dOX1dBSVRfSU5URVJWQUwgPSBvcy5nZXRlbnYoJ1BBQ0tFVF9SQVRFX0RPV05fV0FJVF9JTlRFUlZBTCcpClBBQ0tFVF9SQVRFX1VQX1dBSVRfSU5URVJWQUwgPSBvcy5nZXRlbnYoJ1BBQ0tFVF9SQVRFX1VQX1dBSVRfSU5URVJWQUwnKQpVVElMSVpBVElPTl81MF84MF9XQUlUX0lOVEVSVkFMID0gb3MuZ2V0ZW52KCdVVElMSVpBVElPTl81MF84MF9XQUlUX0lOVEVSVkFMJykKVVRJTElaQVRJT05fODBfMTAwX1dBSVRfSU5URVJWQUwgPSBvcy5nZXRlbnYoJ1VUSUxJWkFUSU9OXzgwXzEwMF9XQUlUX0lOVEVSVkFMJykKVVRJTElaQVRJT05fRE9XTl9XQUlUX0lOVEVSVkFMID0gb3MuZ2V0ZW52KCdVVElMSVpBVElPTl9ET1dOX1dBSVRfSU5URVJWQUwnKQoKbG9nZ2luZ19jb250ZXh0ID0gTm9uZQoKCmRlZiBoYW5kbGVyKGNvbnRleHQsIGV2ZW50KToKICAgIGdsb2JhbCBsb2dnaW5nX2NvbnRleHQKICAgIGxvZ2dpbmdfY29udGV4dD1jb250ZXh0CiAgICBwcmludCgnZXZlbnQgYm9keSBsb2cnLGV2ZW50LmJvZHkuZGVjb2RlKCd1dGYtOCcpKQogICAgY3JlYXRlX3JlY29yZHMoZXZlbnQuYm9keS5kZWNvZGUoJ3V0Zi04Jykuc3BsaXQoIiwiKSwgY29udGV4dCkKCgpkZWYgZ2V0X2t2X3VybChrdl9uYW1lKToKICAgIHJldHVybiAnaHR0cDovL3swfTp7MX0vezJ9L3szfS8nLmZvcm1hdChOR0lOWF9IT1NULCBOR0lOWF9QT1JULCBDT05UQUlORVJfTkFNRSwga3ZfbmFtZSkKCgpkZWYgZ2V0X2Z1bmN0aW9uX2hlYWRlcnModjNpb19mdW5jdGlvbik6CiAgICByZXR1cm4geydDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgICAgICdDYWNoZS1Db250cm9sJzogJ25vLWNhY2hlJywKICAgICAgICAgICAgJ1gtdjNpby1mdW5jdGlvbic6IHYzaW9fZnVuY3Rpb24sCiAgICAgICAgICAgICdDb25uZWN0aW9uJzogJ2tlZXAtYWxpdmUnCiAgICAgICAgICAgIH0KCgpkZWYgdmFsaWRhdGVfc3RyaW5nKHZhbCk6CiAgICBpZiB2YWwgPT0gJ251bGwnOgogICAgICAgIHJldHVybiBOb25lCiAgICByZXR1cm4gdmFsCgoKZGVmIHZhbGlkYXRlX251bWVyaWModmFsKToKICAgIGlmIG5vdCB2YWw6CiAgICAgICAgcmV0dXJuIE5vbmUKICAgIGlmIG5vdCBpc2luc3RhbmNlKHZhbCwgbnVtYmVycy5OdW1iZXIpOgogICAgICAgIHJldHVybiBOb25lCiAgICByZXR1cm4gdmFsCgoKZGVmIGhhbmRsZV9yZXNwb25zZShyZXNwb25zZSwgKiprd2FyZ3MpOgogICAgdHJ5OgogICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlICE9IDIwMDoKICAgICAgICAgICAgbG9nZ2luZ19jb250ZXh0LmxvZ2dlci5lcnJvcigiaW5nZXN0aW9uIGZhaWxlZCB3aXRoIHN0YXR1cyBjb2RlICVzIGZvciByZWNvcmQgJXMiLCByZXNwb25zZS5zdGF0dXNfY29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5yZXF1ZXN0LmJvZHkpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2luZ19jb250ZXh0LmxvZ2dlci5lcnJvcihzdHIoZSkpCgoKZGVmIGhhbmRsZV9leGNlcHRpb24ocmVxdWVzdCwgZXhjZXB0aW9uKToKICAgIGxvZ2dpbmdfY29udGV4dC5sb2dnZXIuZXJyb3Ioc3RyKGV4Y2VwdGlvbikpCgoKZGVmIHNlbmRfcmVjb3Jkc19yYXcobmV0d29ya19kYXRhX3Njb3JlKToKICAgIHRyeToKCiAgICAgICAgam1zZ19yYXcgPSBqc29uLmR1bXBzKGdldF9zdHJ1Y3R1cmVkX21lc3NhZ2VfcmF3KG5ldHdvcmtfZGF0YV9zY29yZSksIGluZGVudD00KQogICAgICAgIHllYXIgPSBuZXR3b3JrX2RhdGFfc2NvcmVbMjFdCiAgICAgICAgbW9udGggPSBuZXR3b3JrX2RhdGFfc2NvcmVbMjJdCiAgICAgICAgZGF5ID0gbmV0d29ya19kYXRhX3Njb3JlWzIzXQogICAgICAgIHBhcnRpdGlvbiA9ICJ5ZWFyPSIgKyBzdHIoeWVhcikgKyAiL21vbnRoPSIgKyBzdHIobW9udGgpICsgIi9kYXk9IiArIHN0cihkYXkpICsgIi8iCiAgICAgICAgdXJsID0gZ2V0X2t2X3VybChSQVdfS1YpICsgcGFydGl0aW9uCiAgICAgICAgcGF5bG9hZCA9IGptc2dfcmF3CiAgICAgICAgaGVhZGVycyA9IGdldF9mdW5jdGlvbl9oZWFkZXJzKCdQdXRJdGVtJykKICAgICAgICAjIHVybCA9IGdldF9rdl91cmwoUkFXX0tWKQogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGF1dGg9KElHWl9VU0VSLCBJR1pfUEFTUyksIGRhdGE9cGF5bG9hZCwgaGVhZGVycz1oZWFkZXJzKQogICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlICE9IDIwMDoKICAgICAgICAgICAgbG9nZ2luZ19jb250ZXh0LmxvZ2dlci5lcnJvcigiaGlzdG9yaWNhbCByZWNvcmQgaW5nZXN0aW9uIGZhaWxlZCB3aXRoIHN0YXR1cyBjb2RlICVzIGZvciByZWNvcmQgJXMiLCByZXNwb25zZS5zdGF0dXNfY29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5yZXF1ZXN0LmJvZHkpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2luZ19jb250ZXh0LmxvZ2dlci5lcnJvcihzdHIoZSkpCiAgICAgICAgcGFzcwoKCmRlZiBzZW5kX3JlY29yZHNfc2NvcmUocmVjb3JkKToKICAgIHRyeToKICAgICAgICBwYXlsb2FkID0gcmVjb3JkCiAgICAgICAgaGVhZGVycyA9IGdldF9mdW5jdGlvbl9oZWFkZXJzKCdQdXRJdGVtJykKICAgICAgICB1cmwgPSBnZXRfa3ZfdXJsKFNDT1JFX0tWKQogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGF1dGg9KElHWl9VU0VSLCBJR1pfUEFTUyksIGRhdGE9cGF5bG9hZCwgaGVhZGVycz1oZWFkZXJzKQogICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlICE9IDIwMDoKICAgICAgICAgICAgbG9nZ2luZ19jb250ZXh0LmxvZ2dlci5lcnJvcigic2NvcmUgaW5nZXN0aW9uIGZhaWxlZCB3aXRoIHN0YXR1cyBjb2RlICVzIGZvciByZWNvcmQgJXMiLCByZXNwb25zZS5zdGF0dXNfY29kZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5yZXF1ZXN0LmJvZHkpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2luZ19jb250ZXh0LmxvZ2dlci5lcnJvcihzdHIoZSkpCiAgICAgICAgcGFzcwoKCmRlZiBnZXRfc3RydWN0dXJlZF9tZXNzYWdlX3Jhdyhtc2cpOgogICAganNvbl9kaWN0ID0gY29sbGVjdGlvbnMuT3JkZXJlZERpY3QoWwogICAgICAgICgnS2V5JywgY29sbGVjdGlvbnMuT3JkZXJlZERpY3QoWygnaWQnLCB7J1MnOiB2YWxpZGF0ZV9zdHJpbmcobXNnWzBdKX0pXSkpLAogICAgICAgICgnSXRlbScsIGNvbGxlY3Rpb25zLk9yZGVyZWREaWN0KFsKICAgICAgICAgICAgKCdsaW5rX2lkJywgeydTJzogdmFsaWRhdGVfc3RyaW5nKG1zZ1sxXSl9KSwKICAgICAgICAgICAgKCdkaXJlY3Rpb24nLCB7J1MnOiB2YWxpZGF0ZV9zdHJpbmcobXNnWzJdKX0pLAogICAgICAgICAgICAoJ3Fvc19pZCcsIHsnTic6IChtc2dbM10pfSksCiAgICAgICAgICAgICgncGVfYWRkJywgeydTJzogdmFsaWRhdGVfc3RyaW5nKG1zZ1s0XSl9KSwKICAgICAgICAgICAgKCdwZV9uYW1lJywgeydTJzogdmFsaWRhdGVfc3RyaW5nKG1zZ1s1XSl9KSwKICAgICAgICAgICAgKCdkZXN0X3BlX25hbWUnLCB7J1MnOiB2YWxpZGF0ZV9zdHJpbmcobXNnWzE5XSl9KSwKICAgICAgICAgICAgKCdzcmNfaW50ZXJmYWNlJywgeydTJzogdmFsaWRhdGVfc3RyaW5nKG1zZ1s2XSl9KSwKICAgICAgICAgICAgKCdkZXN0X2ludGVyZmFjZScsIHsnUyc6IHZhbGlkYXRlX3N0cmluZyhtc2dbMjBdKX0pLAogICAgICAgICAgICAoJ3V0aWwnLCB7J04nOiBzdHIobXNnWzddKX0pLAogICAgICAgICAgICAoJ21heF9idycsIHsnTic6IHN0cihtc2dbOF0pfSksCiAgICAgICAgICAgICgnY3Vycl9jb3N0MScsIHsnTic6IHN0cihtc2dbOV0pfSksCiAgICAgICAgICAgICgnY3Vycl9jb3N0MicsIHsnTic6IHN0cihtc2dbMTBdKX0pLAogICAgICAgICAgICAoJ3V0aWxfcGVyJywgeydOJzogc3RyKG1zZ1sxMV0pfSksCiAgICAgICAgICAgICgnbGlua19zdGF0dXMnLCB7J1MnOiB2YWxpZGF0ZV9zdHJpbmcobXNnWzEyXSl9KSwKICAgICAgICAgICAgKCdwa3RfcmF0ZScsIHsnTic6IHN0cihtc2dbMTNdKX0pLAogICAgICAgICAgICAoJ2xhdGVuY3knLCB7J04nOiBzdHIobXNnWzE0XSl9KSwKICAgICAgICAgICAgKCdhdmdfbGF0ZW5jeScsIHsnTic6IHN0cihtc2dbMTVdKX0pLAogICAgICAgICAgICAoJ2Jhc2VfYXZnX2xhdGVuY3knLCB7J04nOiBzdHIobXNnWzE2XSl9KSwKICAgICAgICAgICAgKCdhbGFybScsIHsnTic6IHN0cihtc2dbMTddKX0pLAogICAgICAgICAgICAoJ3RpbWVfc3RhbXAnLCB7J04nOiBzdHIobXNnWzE4XSl9KSwKICAgICAgICAgICAgKCd5ZWFyJywgeydOJzogc3RyKG1zZ1syMV0pfSksCiAgICAgICAgICAgICgnbW9udGgnLCB7J04nOiBzdHIobXNnWzIyXSl9KSwKICAgICAgICAgICAgKCdkYXknLCB7J04nOiBzdHIobXNnWzIzXSl9KSwKICAgICAgICAgICAgKCd0b3RhbF9zY29yZScsIHsnTic6IHN0cihtc2dbMjRdKX0pCiAgICAgICAgXSkpCiAgICBdKQogICAgcmV0dXJuIGpzb25fZGljdAoKCmRlZiBnZXRfc3RydWN0dXJlZF9tZXNzYWdlX3Njb3JlX2V4aXN0cyhyZWMpOgogICAgaXRlbV9kaWN0ID0gZ2V0X2l0ZW1zX29yZGVyZWRfY29sbGVjdGlvbihyZWMpCiAgICBqc29uX2RpY3QgPSBjb2xsZWN0aW9ucy5PcmRlcmVkRGljdChbCiAgICAgICAgKCdLZXknLCBjb2xsZWN0aW9ucy5PcmRlcmVkRGljdChbKCdpZCcsIHsnUyc6IHZhbGlkYXRlX3N0cmluZyhyZWNbJ0l0ZW0nXVsnaWQnXVsnUyddKX0pXSkpLAogICAgICAgICgnSXRlbScsIGl0ZW1fZGljdCkKICAgIF0pCiAgICByZXR1cm4ganNvbl9kaWN0CgoKZGVmIGdldF9zdHJ1Y3R1cmVkX21lc3NhZ2Vfc2NvcmVfbmV3KG5ldHdvcmtfZGF0YSk6CiAgICBpdGVtX2RpY3QgPSBnZXRfZW1wdHlfc2NvcmVfaXRlbXMobmV0d29ya19kYXRhKSAgIyBsaW5rSWQsIHBlX25hbWUsaW50ZXJmYWNlLGJhc2UgbGF0ZW5jeQogICAganNvbl9kaWN0ID0gY29sbGVjdGlvbnMuT3JkZXJlZERpY3QoWwogICAgICAgICgnS2V5JywgY29sbGVjdGlvbnMuT3JkZXJlZERpY3QoWygnaWQnLCB7J1MnOiB2YWxpZGF0ZV9zdHJpbmcobmV0d29ya19kYXRhWzFdICsgIi4iICsgbmV0d29ya19kYXRhWzNdKX0pXSkpLAogICAgICAgICMga2V5IGFzIGxpbmtJZC5RT1NJRAogICAgICAgICgnSXRlbScsIGl0ZW1fZGljdCkKICAgIF0pCiAgICByZXR1cm4ganNvbl9kaWN0CgoKZGVmIGdldF9pdGVtc19vcmRlcmVkX2NvbGxlY3Rpb24obXNnKToKICAgIGNvbGwgPSBjb2xsZWN0aW9ucy5PcmRlcmVkRGljdCgpCgogICAgY29sbFsnbGlua19pZCddID0geydTJzogbXNnWydJdGVtJ11bJ2xpbmtfaWQnXVsnUyddfQogICAgY29sbFsncGVfbmFtZSddID0geydTJzogbXNnWydJdGVtJ11bJ3BlX25hbWUnXVsnUyddfQogICAgY29sbFsncGVfbmFtZV9kZXN0J10gPSB7J1MnOiBtc2dbJ0l0ZW0nXVsncGVfbmFtZV9kZXN0J11bJ1MnXX0KICAgIGNvbGxbJ2ludGVyZmFjZSddID0geydTJzogbXNnWydJdGVtJ11bJ2ludGVyZmFjZSddWydTJ119CiAgICBjb2xsWydkZXN0X2ludGVyZmFjZSddID0geydTJzogbXNnWydJdGVtJ11bJ2Rlc3RfaW50ZXJmYWNlJ11bJ1MnXX0KICAgIGNvbGxbJ2N1cnJfY29zdDEnXSA9IHsnTic6IHN0cihtc2dbJ0l0ZW0nXVsnY3Vycl9jb3N0MSddWydOJ10pfQogICAgY29sbFsnY3Vycl9jb3N0MiddID0geydOJzogc3RyKG1zZ1snSXRlbSddWydjdXJyX2Nvc3QyJ11bJ04nXSl9CiAgICBjb2xsWydtYXhfYncnXSA9IHsnTic6IHN0cihtc2dbJ0l0ZW0nXVsnbWF4X2J3J11bJ04nXSl9CiAgICBjb2xsWydwZWFrX3V0aWwnXSA9IHsnTic6IHN0cihmbG9hdCgobXNnWydJdGVtJ11bJ3BlYWtfdXRpbCddWydOJ10pKSl9CiAgICBjb2xsWydwa3RfcmF0ZSddID0geydOJzogc3RyKG1zZ1snSXRlbSddWydwa3RfcmF0ZSddWydOJ10pfQogICAgY29sbFsnYXZnX2xhdGVuY3knXSA9IHsnTic6IHN0cihtc2dbJ0l0ZW0nXVsnYXZnX2xhdGVuY3knXVsnTiddKX0KICAgIGNvbGxbJ2Jhc2VfYXZnX2xhdGVuY3knXSA9IHsnTic6IHN0cihtc2dbJ0l0ZW0nXVsnYmFzZV9hdmdfbGF0ZW5jeSddWydOJ10pfQogICAgY29sbFsnbGF0ZW5jeV91cF9jb3VudCddID0geydOJzogc3RyKG1zZ1snSXRlbSddWydsYXRlbmN5X3VwX2NvdW50J11bJ04nXSl9CiAgICBjb2xsWydsYXRlbmN5X2Rvd25fY291bnQnXSA9IHsnTic6IHN0cihtc2dbJ0l0ZW0nXVsnbGF0ZW5jeV9kb3duX2NvdW50J11bJ04nXSl9CiAgICBjb2xsWydsaW5rX3VwX2NvdW50J10gPSB7J04nOiBzdHIobXNnWydJdGVtJ11bJ2xpbmtfdXBfY291bnQnXVsnTiddKX0KICAgIGNvbGxbJ3V0aWxfZG93bl9jb3VudCddID0geydOJzogc3RyKG1zZ1snSXRlbSddWyd1dGlsX2Rvd25fY291bnQnXVsnTiddKX0KICAgIGNvbGxbJ3V0aWxfNTBfODBfY291bnQnXSA9IHsnTic6IHN0cihtc2dbJ0l0ZW0nXVsndXRpbF81MF84MF9jb3VudCddWydOJ10pfQogICAgY29sbFsndXRpbF84MF8xMDBfY291bnQnXSA9IHsnTic6IHN0cihtc2dbJ0l0ZW0nXVsndXRpbF84MF8xMDBfY291bnQnXVsnTiddKX0KICAgIGNvbGxbJ3BhY2tldF9yYXRlX3VwX2NvdW50J10gPSB7J04nOiBzdHIobXNnWydJdGVtJ11bJ3BhY2tldF9yYXRlX3VwX2NvdW50J11bJ04nXSl9CiAgICBjb2xsWydwYWNrZXRfcmF0ZV9kb3duX2NvdW50J10gPSB7J04nOiBzdHIobXNnWydJdGVtJ11bJ3BhY2tldF9yYXRlX2Rvd25fY291bnQnXVsnTiddKX0KICAgIGNvbGxbJ2xhdGVuY3lfc2NvcmUnXSA9IHsnTic6IHN0cihtc2dbJ0l0ZW0nXVsnbGF0ZW5jeV9zY29yZSddWydOJ10pfQogICAgY29sbFsndXRpbF9zY29yZSddID0geydOJzogc3RyKG1zZ1snSXRlbSddWyd1dGlsX3Njb3JlJ11bJ04nXSl9CiAgICBjb2xsWydwYWNrZXRfcmF0ZV9zY29yZSddID0geydOJzogc3RyKG1zZ1snSXRlbSddWydwYWNrZXRfcmF0ZV9zY29yZSddWydOJ10pfQogICAgY29sbFsnbGlua19zdGF0dXNfc2NvcmUnXSA9IHsnTic6IHN0cihtc2dbJ0l0ZW0nXVsnbGlua19zdGF0dXNfc2NvcmUnXVsnTiddKX0KICAgIGNvbGxbJ3RpbWVzdGFtcCddID0geydOJzogc3RyKG1zZ1snSXRlbSddWyd0aW1lc3RhbXAnXVsnTiddKX0KICAgIGNvbGxbJ3RvdGFsX3Njb3JlJ10gPSB7J04nOiBzdHIobXNnWydJdGVtJ11bJ3RvdGFsX3Njb3JlJ11bJ04nXSl9CgogICAgcmV0dXJuIGNvbGwKCgpkZWYgZ2V0X2VtcHR5X3Njb3JlX2l0ZW1zKG5ldHdvcmtfZGF0YSk6CiAgICBjb2xsID0gY29sbGVjdGlvbnMuT3JkZXJlZERpY3QoKQoKICAgIGNvbGxbJ2xpbmtfaWQnXSA9IHsnUyc6IG5ldHdvcmtfZGF0YVsxXX0KICAgIGNvbGxbJ3BlX25hbWUnXSA9IHsnUyc6IG5ldHdvcmtfZGF0YVs1XX0KICAgIGNvbGxbJ3BlX25hbWVfZGVzdCddID0geydTJzogbmV0d29ya19kYXRhWzE5XX0KICAgIGNvbGxbJ2ludGVyZmFjZSddID0geydTJzogbmV0d29ya19kYXRhWzZdfQogICAgY29sbFsnZGVzdF9pbnRlcmZhY2UnXSA9IHsnUyc6IG5ldHdvcmtfZGF0YVsyMF19CiAgICBjb2xsWydiYXNlX2F2Z19sYXRlbmN5J10gPSB7J04nOiBuZXR3b3JrX2RhdGFbMTZdfQogICAgY29sbFsnYXZnX2xhdGVuY3knXSA9IHsnTic6IG5ldHdvcmtfZGF0YVsxNV19CiAgICBjb2xsWydjdXJyX2Nvc3QxJ10gPSB7J04nOiBzdHIobmV0d29ya19kYXRhWzldKX0KICAgIGNvbGxbJ2N1cnJfY29zdDInXSA9IHsnTic6IHN0cihuZXR3b3JrX2RhdGFbMTBdKX0KICAgIGNvbGxbJ21heF9idyddID0geydOJzogc3RyKG5ldHdvcmtfZGF0YVs4XSl9CiAgICBjb2xsWydwZWFrX3V0aWwnXSA9IHsnTic6IHN0cihuZXR3b3JrX2RhdGFbN10pfSAgIyBmb3IgaW5pdGlhbGlzYXRpb24gb2YgbmV3IHJvdyAsIGN1cnJlbnQgdXRpbCBpcyBzZXQgdG8gcGVhayB1dGlsLgogICAgY29sbFsncGt0X3JhdGUnXSA9IHsnTic6IHN0cihuZXR3b3JrX2RhdGFbMTNdKX0KICAgIGNvbGxbJ2F2Z19sYXRlbmN5J10gPSB7J04nOiBzdHIobmV0d29ya19kYXRhWzE1XSl9CiAgICBjb2xsWydiYXNlX2F2Z19sYXRlbmN5J10gPSB7J04nOiBzdHIobmV0d29ya19kYXRhWzE2XSl9CiAgICBjb2xsWydsYXRlbmN5X3VwX2NvdW50J10gPSB7J04nOiAnMCd9CiAgICBjb2xsWydsYXRlbmN5X2Rvd25fY291bnQnXSA9IHsnTic6ICcwJ30KICAgIGNvbGxbJ2xpbmtfdXBfY291bnQnXSA9IHsnTic6ICcwJ30KICAgIGNvbGxbJ3V0aWxfZG93bl9jb3VudCddID0geydOJzogJzAnfQogICAgY29sbFsndXRpbF81MF84MF9jb3VudCddID0geydOJzogJzAnfQogICAgY29sbFsndXRpbF84MF8xMDBfY291bnQnXSA9IHsnTic6ICcwJ30KICAgIGNvbGxbJ3BhY2tldF9yYXRlX3VwX2NvdW50J10gPSB7J04nOiAnMCd9CiAgICBjb2xsWydwYWNrZXRfcmF0ZV9kb3duX2NvdW50J10gPSB7J04nOiAnMCd9CiAgICBjb2xsWydsYXRlbmN5X3Njb3JlJ10gPSB7J04nOiAnMCd9CiAgICBjb2xsWyd1dGlsX3Njb3JlJ10gPSB7J04nOiAnMCd9CiAgICBjb2xsWydwYWNrZXRfcmF0ZV9zY29yZSddID0geydOJzogJzAnfQogICAgY29sbFsnbGlua19zdGF0dXNfc2NvcmUnXSA9IHsnTic6ICcwJ30KICAgIGNvbGxbJ3RpbWVzdGFtcCddID0geydOJzogc3RyKG5ldHdvcmtfZGF0YVsxOF0pfQogICAgY29sbFsndG90YWxfc2NvcmUnXSA9IHsnTic6ICcwJ30KCiAgICByZXR1cm4gY29sbAoKCmRlZiBnZXRfc2NvcmVfcmVjb3JkKGtleSk6CiAgICB0cnk6CiAgICAgICAgcHl0aG9uX2RpY3Rpb25hcnkgPSB7J0F0dHJpYnV0ZXNUb0dldCc6ICcqJ30KICAgICAgICBzY29yZSA9IGpzb24uZHVtcHMocHl0aG9uX2RpY3Rpb25hcnksIGluZGVudD00KQogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdChnZXRfa3ZfdXJsKFNDT1JFX0tWKSArIGtleSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0aD0oSUdaX1VTRVIsIElHWl9QQVNTKSwgZGF0YT1zY29yZSwgaGVhZGVycz1nZXRfZnVuY3Rpb25faGVhZGVycygnR2V0SXRlbScpKQogICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlICE9IDQwNDoKICAgICAgICAgICAgc2NvcmUgPSBqc29uLmxvYWRzKHJlc3BvbnNlLmNvbnRlbnQpCiAgICAgICAgIyBzY29yZSA9IHlhbWwuc2FmZV9sb2FkKHJlc3BvbnNlLmNvbnRlbnQpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2NvcmUgPSBbXQogICAgICAgIHJldHVybiBzY29yZQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dpbmdfY29udGV4dC5sb2dnZXIuZXJyb3Ioc3RyKGUpKQogICAgICAgIHBhc3MKCgpkZWYgY2FsY3VsYXRlX3Njb3JlX2xpbmtfc3RhdHVzKHN0YXR1cywgcmVjb3JkKToKICAgIGlmIHN0YXR1cyA9PSAnRE9XTic6CiAgICAgICAgcmVjb3JkWydJdGVtJ11bJ2xpbmtfdXBfY291bnQnXVsnTiddID0gMAogICAgICAgIHJlY29yZFsnSXRlbSddWydsaW5rX3N0YXR1c19zY29yZSddWydOJ10gPSAxNQogICAgZWxpZiBzdGF0dXMgPT0gJ1VQJyBhbmQgaW50KHJlY29yZFsnSXRlbSddWydsaW5rX3VwX2NvdW50J11bJ04nXSkgPCBpbnQoTElOS19VUF9XQUlUX0lOVEVSVkFMKToKICAgICAgICByZWNvcmRbJ0l0ZW0nXVsnbGlua191cF9jb3VudCddWydOJ10gPSBpbnQocmVjb3JkWydJdGVtJ11bJ2xpbmtfdXBfY291bnQnXVsnTiddKSArIDEKICAgIGVsc2U6CiAgICAgICAgcmVjb3JkWydJdGVtJ11bJ2xpbmtfdXBfY291bnQnXVsnTiddID0gMAogICAgICAgIHJlY29yZFsnSXRlbSddWydsaW5rX3N0YXR1c19zY29yZSddWydOJ10gPSAwCiAgICByZXR1cm4gcmVjb3JkCgoKZGVmIGNhbGN1bGF0ZV9zY29yZV9sYXRlbmN5KGxhdGVuY3ksIHJlY29yZCk6CiAgICBpZiBsYXRlbmN5IDwgMCBhbmQgbGF0ZW5jeSAhPSAtMToKICAgICAgICBpZiBpbnQocmVjb3JkWydJdGVtJ11bJ2xhdGVuY3lfdXBfY291bnQnXVsnTiddKSA8IGludChMQVRFTkNZX1VQX1dBSVRfSU5URVJWQUwpIGFuZCBpbnQoCiAgICAgICAgICAgICAgICByZWNvcmRbJ0l0ZW0nXVsnbGF0ZW5jeV9zY29yZSddWydOJ10pICE9IDg6CiAgICAgICAgICAgIHJlY29yZFsnSXRlbSddWydsYXRlbmN5X3VwX2NvdW50J11bJ04nXSA9IGludChyZWNvcmRbJ0l0ZW0nXVsnbGF0ZW5jeV91cF9jb3VudCddWydOJ10pICsgMQogICAgICAgICAgICByZWNvcmRbJ0l0ZW0nXVsnbGF0ZW5jeV9kb3duX2NvdW50J11bJ04nXSA9IDAKICAgICAgICBlbHNlOgogICAgICAgICAgICByZWNvcmRbJ0l0ZW0nXVsnbGF0ZW5jeV9zY29yZSddWydOJ10gPSA4CiAgICAgICAgICAgIHJlY29yZFsnSXRlbSddWydsYXRlbmN5X2Rvd25fY291bnQnXVsnTiddID0gMAogICAgZWxpZiBsYXRlbmN5ID09IC0xOiAgIyByZXRhaW4gdGhlIHByZXZpb3VzIGNvdW50ZXJzIGlmIGxhdGVuY3kgPSAtMQogICAgICAgIHBhc3MKICAgIGVsc2U6CiAgICAgICAgaWYgaW50KHJlY29yZFsnSXRlbSddWydsYXRlbmN5X2Rvd25fY291bnQnXVsnTiddKSA8IGludChMQVRFTkNZX0RPV05fV0FJVF9JTlRFUlZBTCk6CiAgICAgICAgICAgIHJlY29yZFsnSXRlbSddWydsYXRlbmN5X2Rvd25fY291bnQnXVsnTiddID0gaW50KHJlY29yZFsnSXRlbSddWydsYXRlbmN5X2Rvd25fY291bnQnXVsnTiddKSArIDEKICAgICAgICAgICAgcmVjb3JkWydJdGVtJ11bJ2xhdGVuY3lfdXBfY291bnQnXVsnTiddID0gMAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHJlY29yZFsnSXRlbSddWydsYXRlbmN5X3Njb3JlJ11bJ04nXSA9IDAKICAgICAgICAgICAgcmVjb3JkWydJdGVtJ11bJ2xhdGVuY3lfdXBfY291bnQnXVsnTiddID0gMAogICAgICAgICAgICByZWNvcmRbJ0l0ZW0nXVsnbGF0ZW5jeV9kb3duX2NvdW50J11bJ04nXSA9IDAKICAgIHJldHVybiByZWNvcmQKCgpkZWYgY2FsY3VsYXRlX3Njb3JlX3BrdF9kcm9wKHBrdF9yYXRlLCByZWNvcmQpOgogICAgaWYgcGt0X3JhdGUgPCAxMDA6ICAjIHBrdF9yYXRlID0xMDAgbWVhbnMgbm8gcGFja2V0IGRyb3AKICAgICAgICBpZiBpbnQocmVjb3JkWydJdGVtJ11bJ3BhY2tldF9yYXRlX2Rvd25fY291bnQnXVsnTiddKSA8IGludChQQUNLRVRfUkFURV9ET1dOX1dBSVRfSU5URVJWQUwpIGFuZCBpbnQoCiAgICAgICAgICAgICAgICByZWNvcmRbJ0l0ZW0nXVsncGFja2V0X3JhdGVfc2NvcmUnXVsnTiddKSAhPSA4OgogICAgICAgICAgICByZWNvcmRbJ0l0ZW0nXVsncGFja2V0X3JhdGVfdXBfY291bnQnXVsnTiddID0gMAogICAgICAgICAgICByZWNvcmRbJ0l0ZW0nXVsncGFja2V0X3JhdGVfZG93bl9jb3VudCddWydOJ10gPSBpbnQocmVjb3JkWydJdGVtJ11bJ3BhY2tldF9yYXRlX2Rvd25fY291bnQnXVsnTiddKSArIDEKICAgICAgICAgICAgcmVjb3JkWydJdGVtJ11bJ3BhY2tldF9yYXRlX3Njb3JlJ11bJ04nXSA9IDUKICAgICAgICBlbHNlOgogICAgICAgICAgICByZWNvcmRbJ0l0ZW0nXVsncGFja2V0X3JhdGVfc2NvcmUnXVsnTiddID0gOAogICAgICAgICAgICByZWNvcmRbJ0l0ZW0nXVsncGFja2V0X3JhdGVfdXBfY291bnQnXVsnTiddID0gMAogICAgICAgICAgICByZWNvcmRbJ0l0ZW0nXVsncGFja2V0X3JhdGVfZG93bl9jb3VudCddWydOJ10gPSBpbnQocmVjb3JkWydJdGVtJ11bJ3BhY2tldF9yYXRlX2Rvd25fY291bnQnXVsnTiddKSArIDEKICAgIGVsc2U6CiAgICAgICAgaWYgaW50KHJlY29yZFsnSXRlbSddWydwYWNrZXRfcmF0ZV91cF9jb3VudCddWydOJ10pIDwgaW50KFBBQ0tFVF9SQVRFX1VQX1dBSVRfSU5URVJWQUwpOgogICAgICAgICAgICByZWNvcmRbJ0l0ZW0nXVsncGFja2V0X3JhdGVfZG93bl9jb3VudCddWydOJ10gPSAwCiAgICAgICAgICAgIGlmIGludChyZWNvcmRbJ0l0ZW0nXVsncGFja2V0X3JhdGVfdXBfY291bnQnXVsnTiddKSA8PSAyMDogICMgaW5jcmVtZW50IHRoZSBwYWNrZXQgcmF0ZSB1cCBjb3VudCB0byBtYXggMjAKICAgICAgICAgICAgICAgIHJlY29yZFsnSXRlbSddWydwYWNrZXRfcmF0ZV91cF9jb3VudCddWydOJ10gPSBpbnQocmVjb3JkWydJdGVtJ11bJ3BhY2tldF9yYXRlX3VwX2NvdW50J11bJ04nXSkgKyAxCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcmVjb3JkWydJdGVtJ11bJ3BhY2tldF9yYXRlX3Njb3JlJ11bJ04nXSA9IDAKICAgICAgICAgICAgaWYgaW50KHJlY29yZFsnSXRlbSddWydwYWNrZXRfcmF0ZV91cF9jb3VudCddWydOJ10pIDw9IDIwOiAgIyBpbmNyZW1lbnQgdGhlIHBhY2tldCByYXRlIHVwIGNvdW50IHRvIG1heCAyMAogICAgICAgICAgICAgICAgcmVjb3JkWydJdGVtJ11bJ3BhY2tldF9yYXRlX3VwX2NvdW50J11bJ04nXSA9IGludChyZWNvcmRbJ0l0ZW0nXVsncGFja2V0X3JhdGVfdXBfY291bnQnXVsnTiddKSArIDEKICAgICAgICAgICAgcmVjb3JkWydJdGVtJ11bJ3BhY2tldF9yYXRlX2Rvd25fY291bnQnXVsnTiddID0gMAogICAgcmV0dXJuIHJlY29yZAoKCmRlZiBjYWxjdWxhdGVfc2NvcmVfdXRpbCh1dGlsX3BlciwgcmVjb3JkKToKICAgIGlmIG5vdCBtYXRoLmlzbmFuKAogICAgICAgICAgICB1dGlsX3Blcik6ICAjIGNoZWNrIGlmIHV0aWxpemF0aW9uIHBlcmNlbnRhZ2UgaXMgTmFuICwgZWxzZSByZXRhaW4gdGhlIHByZXZpb3VzIHZhbHVlcyBvZiBzY29yZSByZWNvcmQuCiAgICAgICAgaWYgdXRpbF9wZXIgPj0gODA6CiAgICAgICAgICAgIGlmIGludChyZWNvcmRbJ0l0ZW0nXVsndXRpbF84MF8xMDBfY291bnQnXVsnTiddKSA+PSBpbnQoVVRJTElaQVRJT05fODBfMTAwX1dBSVRfSU5URVJWQUwpIGFuZCBpbnQoCiAgICAgICAgICAgICAgICAgICAgcmVjb3JkWydJdGVtJ11bJ3V0aWxfc2NvcmUnXVsnTiddKSA9PSA1OgogICAgICAgICAgICAgICAgcmVjb3JkWydJdGVtJ11bJ3V0aWxfODBfMTAwX2NvdW50J11bJ04nXSA9IGludChyZWNvcmRbJ0l0ZW0nXVsndXRpbF84MF8xMDBfY291bnQnXVsnTiddKSArIDEKICAgICAgICAgICAgICAgIHJlY29yZFsnSXRlbSddWyd1dGlsXzUwXzgwX2NvdW50J11bJ04nXSA9IDAKICAgICAgICAgICAgICAgIHJlY29yZFsnSXRlbSddWyd1dGlsX2Rvd25fY291bnQnXVsnTiddID0gMAogICAgICAgICAgICAgICAgcmVjb3JkWydJdGVtJ11bJ3V0aWxfc2NvcmUnXVsnTiddID0gOAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmVjb3JkWydJdGVtJ11bJ3V0aWxfODBfMTAwX2NvdW50J11bJ04nXSA9IGludChyZWNvcmRbJ0l0ZW0nXVsndXRpbF84MF8xMDBfY291bnQnXVsnTiddKSArIDEKICAgICAgICAgICAgICAgIHJlY29yZFsnSXRlbSddWyd1dGlsXzUwXzgwX2NvdW50J11bJ04nXSA9IDAKICAgICAgICAgICAgICAgIHJlY29yZFsnSXRlbSddWyd1dGlsX2Rvd25fY291bnQnXVsnTiddID0gMAogICAgICAgIGVsaWYgODAgPiB1dGlsX3BlciA+IDUwOgogICAgICAgICAgICBpZiBpbnQocmVjb3JkWydJdGVtJ11bJ3V0aWxfNTBfODBfY291bnQnXVsnTiddKSA+PSBpbnQoVVRJTElaQVRJT05fNTBfODBfV0FJVF9JTlRFUlZBTCk6CiAgICAgICAgICAgICAgICByZWNvcmRbJ0l0ZW0nXVsndXRpbF81MF84MF9jb3VudCddWydOJ10gPSBpbnQocmVjb3JkWydJdGVtJ11bJ3V0aWxfNTBfODBfY291bnQnXVsnTiddKSArIDEKICAgICAgICAgICAgICAgIHJlY29yZFsnSXRlbSddWyd1dGlsXzgwXzEwMF9jb3VudCddWydOJ10gPSAwCiAgICAgICAgICAgICAgICByZWNvcmRbJ0l0ZW0nXVsndXRpbF9kb3duX2NvdW50J11bJ04nXSA9IDAKICAgICAgICAgICAgICAgIHJlY29yZFsnSXRlbSddWyd1dGlsX3Njb3JlJ11bJ04nXSA9IDUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJlY29yZFsnSXRlbSddWyd1dGlsXzUwXzgwX2NvdW50J11bJ04nXSA9IGludChyZWNvcmRbJ0l0ZW0nXVsndXRpbF81MF84MF9jb3VudCddWydOJ10pICsgMQogICAgICAgICAgICAgICAgcmVjb3JkWydJdGVtJ11bJ3V0aWxfODBfMTAwX2NvdW50J11bJ04nXSA9IDAKICAgICAgICAgICAgICAgIHJlY29yZFsnSXRlbSddWyd1dGlsX2Rvd25fY291bnQnXVsnTiddID0gMAogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlmIHV0aWxfcGVyIDw9IDUwIGFuZCBpbnQocmVjb3JkWydJdGVtJ11bJ3V0aWxfZG93bl9jb3VudCddWydOJ10pIDw9IGludChVVElMSVpBVElPTl9ET1dOX1dBSVRfSU5URVJWQUwpOgogICAgICAgICAgICAgICAgaWYgaW50KHJlY29yZFsnSXRlbSddWyd1dGlsX2Rvd25fY291bnQnXVsnTiddKSA8PSAyMDogICMgaW5jcmVtZW50IHRoZSB1dGlsaXphdG9uIGRvd24gY291bnQgdG8gbWF4IDIwCiAgICAgICAgICAgICAgICAgICAgcmVjb3JkWydJdGVtJ11bJ3V0aWxfZG93bl9jb3VudCddWydOJ10gPSBpbnQocmVjb3JkWydJdGVtJ11bJ3V0aWxfZG93bl9jb3VudCddWydOJ10pICsgMQogICAgICAgICAgICAgICAgcmVjb3JkWydJdGVtJ11bJ3V0aWxfODBfMTAwX2NvdW50J11bJ04nXSA9IDAKICAgICAgICAgICAgICAgIHJlY29yZFsnSXRlbSddWyd1dGlsXzUwXzgwX2NvdW50J11bJ04nXSA9IDAKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJlY29yZFsnSXRlbSddWyd1dGlsX3Njb3JlJ11bJ04nXSA9IDAKICAgICAgICAgICAgICAgIGlmIGludChyZWNvcmRbJ0l0ZW0nXVsndXRpbF9kb3duX2NvdW50J11bJ04nXSkgPD0gMjA6ICAjIGluY3JlbWVudCB0aGUgdXRpbGl6YXRvbiBkb3duIGNvdW50IHRvIG1heCAyMAogICAgICAgICAgICAgICAgICAgIHJlY29yZFsnSXRlbSddWyd1dGlsX2Rvd25fY291bnQnXVsnTiddID0gaW50KHJlY29yZFsnSXRlbSddWyd1dGlsX2Rvd25fY291bnQnXVsnTiddKSArIDEKICAgICAgICAgICAgICAgIHJlY29yZFsnSXRlbSddWyd1dGlsXzgwXzEwMF9jb3VudCddWydOJ10gPSAwCiAgICAgICAgICAgICAgICByZWNvcmRbJ0l0ZW0nXVsndXRpbF81MF84MF9jb3VudCddWydOJ10gPSAwCiAgICByZXR1cm4gcmVjb3JkCgoKZGVmIGNhbGN1bGF0ZV9wZWFrX3V0aWwodXRpbCwgcmVjb3JkLCB0c19kYXlfbmV3KToKICAgIGRfZXhpc3RpbmcgPSBkYXRldGltZS5kYXRldGltZS51dGNmcm9tdGltZXN0YW1wKGludChyZWNvcmRbJ0l0ZW0nXVsndGltZXN0YW1wJ11bJ04nXSkpICsgZGF0ZXRpbWUudGltZWRlbHRhKAogICAgICAgIGhvdXJzPSs4KSAgIyBjb252ZXJ0IHV0YyB0aW1lIHRvIHNpbmdhcG9yZSB0aW1lCiAgICB0c19kYXlfZXhpc3RpbmcgPSBkX2V4aXN0aW5nLmRheQoKICAgIGlmIHRzX2RheV9uZXcgPT0gdHNfZGF5X2V4aXN0aW5nOgogICAgICAgIGlmIHV0aWwgPiBmbG9hdChyZWNvcmRbJ0l0ZW0nXVsncGVha191dGlsJ11bJ04nXSk6CiAgICAgICAgICAgIHJlY29yZFsnSXRlbSddWydwZWFrX3V0aWwnXVsnTiddID0gdXRpbAogICAgZWxzZToKICAgICAgICByZWNvcmRbJ0l0ZW0nXVsncGVha191dGlsJ11bJ04nXSA9IHV0aWwKICAgIHJldHVybiByZWNvcmQKCgpkZWYgY3JlYXRlX3JlY29yZHMocmVjLCBjb250ZXh0KToKICAgIG5ldHdvcmtfZGF0YSA9IHR1cGxlKHJlYykKICAgIHNjb3JlX3JlY29yZCA9IGdldF9zY29yZV9yZWNvcmQobmV0d29ya19kYXRhWzFdICsgIi4iICsgbmV0d29ya19kYXRhWzNdKQogICAgaWYgc2NvcmVfcmVjb3JkOgogICAgICAgIHNjb3JlX3JlY29yZCA9IGNhbGN1bGF0ZV9zY29yZV9saW5rX3N0YXR1cyhuZXR3b3JrX2RhdGFbMTJdLCBzY29yZV9yZWNvcmQpCiAgICAgICAgc2NvcmVfcmVjb3JkID0gY2FsY3VsYXRlX3Njb3JlX3BrdF9kcm9wKGludChuZXR3b3JrX2RhdGFbMTNdKSwgc2NvcmVfcmVjb3JkKQogICAgICAgIHNjb3JlX3JlY29yZCA9IGNhbGN1bGF0ZV9zY29yZV9sYXRlbmN5KGZsb2F0KG5ldHdvcmtfZGF0YVsxNF0pLCBzY29yZV9yZWNvcmQpCiAgICAgICAgc2NvcmVfcmVjb3JkID0gY2FsY3VsYXRlX3Njb3JlX3V0aWwoZmxvYXQobmV0d29ya19kYXRhWzExXSksIHNjb3JlX3JlY29yZCkgICMgdHlwZTogaW50CiAgICAgICAgc2NvcmVfcmVjb3JkID0gY2FsY3VsYXRlX3BlYWtfdXRpbChmbG9hdChuZXR3b3JrX2RhdGFbN10pLCBzY29yZV9yZWNvcmQsIG5ldHdvcmtfZGF0YVsyM10pCiAgICAgICAgc2NvcmVfcmVjb3JkWydJdGVtJ11bJ3RvdGFsX3Njb3JlJ11bJ04nXSA9IGludChzY29yZV9yZWNvcmRbJ0l0ZW0nXVsnbGF0ZW5jeV9zY29yZSddWydOJ10pICsgaW50KAogICAgICAgICAgICBzY29yZV9yZWNvcmRbJ0l0ZW0nXVsndXRpbF9zY29yZSddWydOJ10pICsgaW50KHNjb3JlX3JlY29yZFsnSXRlbSddWydwYWNrZXRfcmF0ZV9zY29yZSddWydOJ10pICsgaW50KAogICAgICAgICAgICBzY29yZV9yZWNvcmRbJ0l0ZW0nXVsnbGlua19zdGF0dXNfc2NvcmUnXVsnTiddKQogICAgICAgIHNjb3JlX3JlY29yZFsnSXRlbSddWyd0aW1lc3RhbXAnXVsnTiddID0gaW50KG5ldHdvcmtfZGF0YVsxOF0pCiAgICAgICAgam1zZ19zY29yZSA9IGpzb24uZHVtcHMoCiAgICAgICAgICAgIGdldF9zdHJ1Y3R1cmVkX21lc3NhZ2Vfc2NvcmVfZXhpc3RzKHNjb3JlX3JlY29yZCkpICAjIEZhbHNlIGlzIHNldCBmb3IgcmVjb3JkIHdoaWNoIGFscmVhZHkgZXhpc3RzLgogICAgICAgIG5ldHdvcmtfZGF0YV9zY29yZSA9IG5ldHdvcmtfZGF0YSArIChzY29yZV9yZWNvcmRbJ0l0ZW0nXVsndG90YWxfc2NvcmUnXVsnTiddLCkKICAgIGVsc2U6CiAgICAgICAgam1zZ19zY29yZSA9IGpzb24uZHVtcHMoZ2V0X3N0cnVjdHVyZWRfbWVzc2FnZV9zY29yZV9uZXcobmV0d29ya19kYXRhKSkKICAgICAgICBuZXR3b3JrX2RhdGFfc2NvcmUgPSBuZXR3b3JrX2RhdGEgKyAoMCwpCiAgICBzZW5kX3JlY29yZHNfcmF3KG5ldHdvcmtfZGF0YV9zY29yZSkKICAgIHNlbmRfcmVjb3Jkc19zY29yZShqbXNnX3Njb3JlKQoKIyNmb3IgdGVzdAojIHJlYyA9IFsnMTA1Mi4xXzUwJywgJzEwNTInLCAnMScsICcxNjc3NzMyMicsICcyMDIuMTYzLjU5LjgyJywgJ1NOR1BDLUVSMycsICdnZS01LzMvMC4wJywgJzIzNDYyMDc5LjgxJywgMTI1MDAwMDAwTCwgJ1VQJywgMTAwLCAnMS4wMDAwJywgMCwgMTUyNDEzMTQzNF0KIyBjcmVhdGVfcmVjb3JkcyhyZWMpCg==
    timestamp: 1560218951
    runtimeAttributes:
      repositories: []
    noCleanup: false
    noCache: false
    offline: false
    codeEntryType: sourceCode
    image: ""
    dependencies: []
